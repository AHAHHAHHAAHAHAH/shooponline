---
import Layout from "../../layouts/Layout.astro";
import data from "../../data/data.json";
---

<Layout title="Admin Login" noIndex={true}>
  <div class="login-page">
    <div class="login-card">
      <div class="login-logo">{data.pub.nome}</div>
      <div class="login-subtitle">Pannello Amministratore</div>

      <form id="loginForm" class="login-form">
        <div class="form-group">
          <label class="label">Email</label>
          <input type="email" id="loginEmail" class="input" placeholder="admin@tuopub.it" required />
        </div>
        <div class="form-group">
          <label class="label">Password</label>
          <input type="password" id="loginPassword" class="input" placeholder="••••••••" required />
        </div>
        <div id="loginError" class="login-error" style="display:none;"></div>
        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:8px;" id="loginBtn">
          <span id="loginText">Accedi</span>
          <span class="spinner" id="loginSpinner" style="display:none;"></span>
        </button>
      </form>
    </div>
  </div>
</Layout>

<style>
  .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px; background: radial-gradient(ellipse at 50% 30%, rgba(200,146,42,0.05) 0%, transparent 60%); }
  .login-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 48px 40px; width: 100%; max-width: 400px; }
  .login-logo { font-family: var(--font-display); font-size: 1.8rem; color: var(--accent-light); font-weight: 700; margin-bottom: 4px; }
  .login-subtitle { font-size: 0.82rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); margin-bottom: 36px; }
  .login-form { display: flex; flex-direction: column; gap: 20px; }
  .login-error { background: var(--danger-bg); border: 1px solid var(--danger); color: var(--danger); padding: 10px 14px; border-radius: var(--radius-sm); font-size: 0.88rem; }
</style>

<script>
  import { getFirebaseClient } from "../../lib/firebase-client";
  import { signInWithEmailAndPassword } from "firebase/auth";

  document.getElementById("loginForm")?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = (document.getElementById("loginEmail") as HTMLInputElement).value;
    const password = (document.getElementById("loginPassword") as HTMLInputElement).value;
    const btn = document.getElementById("loginBtn") as HTMLButtonElement;
    const text = document.getElementById("loginText")!;
    const spinner = document.getElementById("loginSpinner")!;
    const errEl = document.getElementById("loginError")!;

    btn.disabled = true;
    text.style.display = "none";
    spinner.style.display = "inline-block";
    errEl.style.display = "none";

    try {
      const { auth } = getFirebaseClient();
      await signInWithEmailAndPassword(auth, email, password);
      window.location.href = "/admin/dashboard";
    } catch (err: any) {
      errEl.textContent = "Email o password non corretti.";
      errEl.style.display = "block";
      btn.disabled = false;
      text.style.display = "inline";
      spinner.style.display = "none";
    }
  });
</script>
